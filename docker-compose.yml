version: '3.8'

# Alternative to devcontainer - run with docker compose
# Usage: docker compose up

services:
  godot:
    build:
      context: .
      dockerfile: .devcontainer/Dockerfile
    ports:
      - "6080:6080"   # noVNC (Godot display)
      - "8765:8765"   # WebSocket server
      - "8000:8000"   # Tablet web server
    volumes:
      - .:/workspace
      - godot-config:/home/vscode/.config/godot
      - godot-data:/home/vscode/.local/share/godot
    environment:
      - DISPLAY=:1
    devices:
      - /dev/dri:/dev/dri  # GPU acceleration (optional)
    shm_size: '2gb'
    command: >
      bash -c "
        # Start display services
        Xvfb :1 -screen 0 1920x1080x24 &
        sleep 2
        fluxbox &
        x11vnc -display :1 -forever -shared -rfbport 5901 -bg
        websockify --web=/usr/share/novnc 6080 localhost:5901 &

        # Keep container running
        echo 'Services started. Access Godot at http://localhost:6080/vnc.html'
        tail -f /dev/null
      "

volumes:
  godot-config:
  godot-data:
